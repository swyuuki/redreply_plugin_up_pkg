[{"content":{"code":"【@<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n <meta charset=\"UTF-8\">\n <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n <title>上传包文件</title>\n <style>\n  #jsonTextBox {\n   width: 100%;\n   height: 200px;\n  }\n  .inline-container {\n   display: flex;\n   align-items: center;\n  }\n  #pkgNameTextBox {\n   width: 200px;\n   height: 30px;\n   margin-right: 10px;\n  }\n  #uploadButton {\n   height: 30px;\n  }\n </style>\n</head>\n<body>\n <h1>上传包中script.json文件</h1>\n <input type=\"file\" id=\"jsonFileInput\" accept=\".json\">\n <br><br>\n <textarea id=\"jsonTextBox\" placeholder=\"上传的JSON文件内容将显示在这里\" readonly></textarea>\n <br><br>\n\n <div class=\"inline-container\">\n  <textarea id=\"pkgNameTextBox\" placeholder=\"输入包名（必填）\"></textarea>\n  <button id=\"uploadButton\">上传到服务器</button>\n </div>\n\n <script>\n  let jsonContent = [];\n\n  document.getElementById('jsonFileInput').addEventListener('change', function(event) {\n   const file = event.target.files[0];\n   if (file) {\n    const reader = new FileReader();\n    reader.onload = function(e) {\n     const contents = e.target.result;\n     try {\n      jsonContent = JSON.parse(contents);\n      document.getElementById('jsonTextBox').value = JSON.stringify(jsonContent, null, 2);\n\n      // 自动填充包名文本框\n      if (jsonContent.length > 0 && jsonContent[0].pkg_name) {\n       document.getElementById('pkgNameTextBox').value = jsonContent[0].pkg_name;\n      } else {\n       document.getElementById('pkgNameTextBox').value = '';\n      }\n     } catch (err) {\n      alert('文件解析错误，请确保上传的是有效的JSON文件。');\n     }\n    };\n    reader.readAsText(file);\n   }\n  });\n\n  document.getElementById('pkgNameTextBox').addEventListener('input', function() {\n   const pkgName = this.value.trim();\n   if (jsonContent.length > 0) {\n    jsonContent.forEach(item => {\n     item.pkg_name = pkgName;\n    });\n    document.getElementById('jsonTextBox').value = JSON.stringify(jsonContent, null, 2);\n   }\n  });\n\n  document.getElementById('uploadButton').addEventListener('click', function() {\n   const pkgName = document.getElementById('pkgNameTextBox').value.trim();\n\n   if (!pkgName) {\n    alert('包名必填，请输入包名。');\n    return;\n   }\n\n   if (jsonContent.length === 0) {\n    alert('请先上传并展示JSON文件内容。');\n    return;\n   }\n\n   const payload = {\n    pkg_name: pkgName,\n    data: jsonContent\n   };\n\n   const uploadUrl = '/save_one_pkg';\n\n   fetch(uploadUrl, {\n    method: 'POST',\n    headers: {\n     'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n   })\n   .then(response => {\n    if (!response.ok) {\n     throw new Error('服务器响应错误');\n    }\n    return response.json();\n   })\n   .then(data => {\n    // 上传成功后在新标签页中打开指定页面\n    window.open(`/pkg_edit.html?pkg_name=${encodeURIComponent(pkgName)}`, '_blank');\n   })\n   .catch(error => {\n    console.error('上传失败:', error);\n    alert('上传失败，请检查网络或文件内容。');\n   });\n  });\n </script>\n</body>\n</html>\n】\n\n","关键词":"/up","匹配方式":"完全匹配","触发方式":"网络触发"},"description":"网址：http://host:port/user/up/up","name":"上传包","pkg_name":"up"}]